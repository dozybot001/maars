# Idea 分解流程改进建议

本文档记录 Planner 模块的改进方向，供后续迭代开发参考。当前 MVP 已满足基本需求，以下为可选增强项。

---

## 1. 质量闭环

### 1.1 低分自动重试

**现状**：Quality 评估在分解完成后执行，低分时无自动处理。

**建议**：
- 若 `score < 60`，可对部分任务尝试重新 atomicity/decompose
- 或对低分任务做「局部重分解」并再次评估

### 1.2 边界任务 Atomicity 投票

**现状**：边界任务（如「文献调研：系统收集和综述」）的 atomicity 可能因模型波动而不同。

**建议**：对关键节点做 2–3 次采样并投票，提高一致性。

---

## 2. 前置优化

### 2.1 Idea Refinement 阶段

**现状**：用户 idea 直接作为 task0 的 description，无澄清步骤。

**建议**：对模糊或宽泛 idea 增加可选预处理：
- 明确研究问题、假设、约束
- 拆成可分解的子问题

### 2.2 全局一致性检查

**现状**：每次分解只看到当前任务和兄弟，无整棵树视图。

**建议**：在 depth=0 或 depth=1 做一次全局检查：
- 当前分解是否覆盖 idea 的全部目标
- 各分支是否有重叠或遗漏

---

## 3. 上下文增强

### 3.1 Format 时传入依赖 artifact

**现状**：Format 只看到当前原子任务，无法看到上游依赖的 artifact 定义。

**建议**：在 Format 时传入依赖任务的 `input/output` 结构，减少接口不一致。

### 3.2 兄弟任务完整信息

**现状**：并行处理时，siblings 仅包含已存在的任务，不包含兄弟的完整 description。

**建议**：若兄弟任务已分解，可传入兄弟的 description 以帮助明确边界。

---

## 4. 其他优化

### 4.1 批处理 / 缓存

**现状**：每个任务单独调用 LLM，树大时调用次数多。

**建议**：对部分操作（如同层 atomicity 判断）探索批处理或缓存，降低 token 消耗。

---

## 优先级建议

| 优先级 | 项目 | 理由 |
|--------|------|------|
| P1 | 低分重试 | 提升分解质量 |
| P2 | Idea Refinement | 提升输入质量 |
| P2 | Format 依赖上下文 | 提升 I/O 一致性 |
| P3 | 其他 | 按需迭代 |
